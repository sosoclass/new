<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>练习</title>
</head>
<body>
<input type="text" placeholder="请输入验证码">
<button id="btn">点击获取验证码</button>

<script>
  //  let lastTime = 0;
  //  let hasXHR = null;
  //
  //  document.getElementById('btn').onclick = function () {
  //    const nowTime = Date.now();
  //    if (nowTime - lastTime <= 5000) return;
  //    lastTime = nowTime;
  //
  //    let time = 5;
  //
  //    this.innerText = `已发送(${time}s)`;
  //    this.style.color = 'gray';
  //    const timer = setInterval(() => {
  //      this.innerText = `已发送(${--time}s)`
  //      if (time <= 0) {
  //        this.innerText = '点击获取验证码';
  //        this.style.color = 'black'
  //        clearInterval(timer);
  //      }
  //    }, 1000);
  //
  //    if (hasXHR) {
  //      hasXHR.abort();
  //
  //    }
  //    hasXHR = sendAjax('GET', '/testAjax');
  //
  //  };
  //
  //  function sendAjax(method, url) {
  //    const xhr = new XMLHttpRequest();
  //    xhr.onreadystatechange = function () {
  //      if (xhr.readyState === 4 && xhr.status === 200) {
  //        console.log(xhr.responseText);
  //        hasXHR = null
  //      }
  //    };
  //    xhr.open(method, url);
  //    xhr.send();
  //    return xhr;
  //  }


  let lastTime = 0;
  let hasXHR = null;

  document.getElementById('btn').onclick = function () {
    const nowTime = Date.now();
    if (nowTime - lastTime <= 5000)return;
    lastTime = nowTime;
    let time = 5;
    this.innerText = `已发送(${time}s)`;
    this.style.color = 'gray';
    const timer = setInterval(() => {
      this.innerText = `已发送(${--time}s)`;
      this.style.color = 'gray';
      if (time <= 0) {
        this.innerText = '请输入验证码';
        this.style.color = 'black';
        clearInterval(timer);
      }
    }, 1000)
    if(hasXHR){
      hasXHR.abort();
    }
    hasXHR = sendAjax('GET','/testAjax');


  };

  function sendAjax(method,url) {
    const xhr = new XMLHttpRequest();
    xhr.onreadystatechange =()=> {
      if(xhr.readyState ===4 && xhr.status===200){
        console.log(xhr.responseText);
        hasXHR = null;
      }
    }
    xhr.open(method,url);
    xhr.send();
    return xhr;
  }

</script>

</body>
</html>